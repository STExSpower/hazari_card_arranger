<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hazari Card Arranger</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
    h1 { text-align: center; }
    textarea { width: 100%; height: 100px; font-size: 16px; padding: 10px; }
    button { padding: 5px 10px; margin: 2px; cursor: pointer; }
    .card-button {
      font-family: 'Courier New', monospace;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 5px;
      min-width: 42px;
    }
    .suit-title {
      margin-top: 10px;
      margin-bottom: 5px;
      font-weight: bold;
      font-size: 16px;
    }
    .result {
      background: #fff;
      padding: 15px;
      margin-top: 20px;
      border-radius: 8px;
    }
    .set { 
      margin-bottom: 10px; 
      font-size: 18px; 
    }
  </style>
</head>
<body>
  <h1>Hazari Card Arranger</h1>

  <div class="card-picker" id="cardPicker"></div>

  <p>Selected Cards (max 13):</p>
  <textarea id="cardInput" placeholder="Click cards above to add them..."></textarea><br>
  <button onclick="arrangeCards()">Arrange</button>
  <button onclick="clearInput()">Clear</button>

  <div class="result" id="result"></div>

  <script>
    const suits = { "S": "♠", "H": "♥", "D": "♦", "C": "♣" };
    const suitNames = {
      "S": "Spades ♠", "H": "Hearts ♥", "D": "Diamonds ♦", "C": "Clubs ♣"
    };
    const redSuits = ["H", "D"];
    const suitList = ["S", "H", "D", "C"];
    const rankList = ["A", "K", "Q", "J", "10", "9", "8", "7", "6", "5", "4", "3", "2"];
    const rankOrder = {"A": 14, "K":13, "Q":12, "J":11, "10":10, "9":9, "8":8, "7":7, "6":6, "5":5, "4":4, "3":3, "2":2};
    const comboRank = {
      "Troy": 6,
      "Colour Run": 5,
      "Run": 4,
      "Colour": 3,
      "Pair": 2,
      "Indi": 1
    };

    function parseCard(card) {
      return card.length === 3 ? [card.slice(0,2), card[2]] : [card[0], card[1]];
    }

    function cardSymbol(card) {
      const [rank, suit] = parseCard(card);
      return rank + suits[suit];
    }

    function isConsecutive(values) {
      const sorted = [...values].sort((a,b) => a - b);
      if (sorted[2] - sorted[0] === 2 && new Set(sorted).size === 3) return true;
      if (sorted.includes(14) && sorted.includes(2) && sorted.includes(3)) {
        const aceLow = sorted.map(v => v === 14 ? 1 : v).sort((a,b)=>a-b);
        return aceLow[2] - aceLow[0] === 2 && new Set(aceLow).size === 3;
      }
      return false;
    }

    function getCombinationType(cards) {
      const ranks = cards.map(c => parseCard(c)[0]);
      const suits = cards.map(c => parseCard(c)[1]);
      const values = ranks.map(r => rankOrder[r]).sort((a,b) => b - a);
      const rankCount = ranks.reduce((acc, r) => (acc[r] = (acc[r] || 0)+1, acc), {});
      if (new Set(ranks).size === 1) return ["Troy", values];
      if (new Set(suits).size === 1 && isConsecutive(values)) return ["Colour Run", values];
      if (isConsecutive(values)) return ["Run", values];
      if (new Set(suits).size === 1) return ["Colour", values];
      if (Object.values(rankCount).includes(2)) return ["Pair", values];
      return ["Indi", values];
    }

    function rankCombo(cards) {
      const [type, vals] = getCombinationType(cards);
      return [comboRank[type], vals];
    }

    function tryCombinations(cards, sizes) {
      if (!sizes.length) return [[]];
      let results = [];
      let size = sizes[0];
      function combine(arr, k, start=0, path=[]) {
        if (path.length === k) {
          const rest = arr.filter(x => !path.includes(x));
          const subresults = tryCombinations(rest, sizes.slice(1));
          for (let sub of subresults) results.push([path, ...sub]);
          return;
        }
        for (let i = start; i < arr.length; i++) {
          combine(arr, k, i + 1, [...path, arr[i]]);
        }
      }
      combine(cards, size);
      return results;
    }

    function arrangeCards() {
      const input = document.getElementById("cardInput").value.trim().split(/\s+/);
      if (input.length !== 13) {
        alert("Please enter exactly 13 cards.");
        return;
      }

      const allArrangements = tryCombinations(input, [3,3,3,4]);
      let bestScore = -1;
      let bestSet = null;

      for (const sets of allArrangements) {
        const score = sets.reduce((sum, group) => {
          const [r, vals] = rankCombo(group);
          return sum + r * 100000 + vals.reduce((a,b) => a + b, 0);
        }, 0);
        if (score > bestScore) {
          bestScore = score;
          bestSet = sets;
        }
      }

      // ✅ সাধারন কম্বো র‍্যাংক অনুসারে সাজানো
      bestSet.sort((a, b) => {
        const [aType, aVals] = getCombinationType(a);
        const [bType, bVals] = getCombinationType(b);
        const aRank = comboRank[aType];
        const bRank = comboRank[bType];
        if (aRank === bRank) {
          const aSum = aVals.reduce((x, y) => x + y, 0);
          const bSum = bVals.reduce((x, y) => x + y, 0);
          return bSum - aSum;
        }
        return bRank - aRank;
      });

      const result = document.getElementById("result");
      result.innerHTML = "<h2>Best Arrangement</h2>" + bestSet.map((set, i) => {
        const [type] = getCombinationType(set);
        const showCards = set.map(card => cardSymbol(card)).join(" ");
        return `<div class="set">Set ${i+1} (<strong>${type}</strong>): ${showCards}</div>`;
      }).join("");
    }

    function clearInput() {
      document.getElementById("cardInput").value = "";
    }

    function generateCardButtons() {
      const container = document.getElementById("cardPicker");
      suitList.forEach(suit => {
        const title = document.createElement('div');
        title.className = 'suit-title';
        title.innerHTML = suitNames[suit];
        container.appendChild(title);

        rankList.forEach(rank => {
          const card = rank + suit;
          const btn = document.createElement("button");
          btn.className = "card-button";
          btn.innerHTML = `${rank}${suits[suit]}`;
          btn.style.color = redSuits.includes(suit) ? "red" : "black";
          btn.onclick = function () {
            const input = document.getElementById("cardInput");
            let current = input.value.trim().split(/\s+/).filter(c => c !== "");
            if (current.length >= 13) {
              alert("You've already selected 13 cards.");
              return;
            }
            current.push(card);
            input.value = current.join(" ");
          };
          container.appendChild(btn);
        });

        container.appendChild(document.createElement("br"));
      });
    }

    generateCardButtons();
  </script>
</body>
</html>